#include "gmock/gmock.h"
#include "Python.h"

#define NAME python_bindings

PyMODINIT_FUNC
PyInit_ik(void);

using namespace ::testing;

class NAME : public Test
{
public:
    virtual void SetUp()
    {
        PyImport_AppendInittab("ik", PyInit_ik);
        Py_Initialize();
        // "module 'sys' has no attribute 'argv'"
        PyRun_SimpleString("import sys\nsys.argv = ['./ik_tests']");
        // sys.exit() would cause the program to exit. Raise an exception instead so PyRun_SimpleString() returns non-zero if exit was called
        PyRun_SimpleString(
            "import sys\n"
            "def stub(x):\n"
            "    if x:\n"
            "        raise RuntimeError(\"sys.exit({})\".format(x))\n"
            "sys.exit = stub");
    }

    virtual void TearDown()
    {
        EXPECT_THAT(Py_FinalizeEx(), Eq(0));
    }
};
